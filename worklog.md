# metrics 
## alloy -> VMs -> Grafana Dashboards (Kubernetes / Compute Resourses / ...)
### 1. Раскатил стенд (обновил на текущие версии)

### 2. VMs -> Grafana Dashboards - это взаимодействие есть (VMs настроен как источник, API vms работает)

### 3. alloy -> VMs - тут какая-то хрень, поды друг друга видят, у alloy конфиг настроен на сбор и отправку в vms метрик кластера и всего остального (API доступно), но почему-то он не пишет метрики (всё rbac проверил у alloy есть доступ до всего в кластере)

Конфиги прогнал через гпт - он всё апрувнул что всё ок

смысл такой что мы переходим по http://<alloy-service>/targets -> должны увидеть что alloy скрапит но тут пусто

в логах у alloy также должны увидеть что по remote_write он пишет в vm

нужно спросить у стаса реализовывал ли он это взаимодействие alloy -> VMs? Но судя по метрикам с vm - нет



26.05.25

Поставил alloy локально
очень полезно сначала для валидации конфига

alloy run ./4.alloy 

после того как провалидировали заходим в линзу в конфигмапы и видим alloy (НЕ alloy-config)

туда кидаем конфиг, сохраняем, и идет убивать под, тчобы он подхватил актуальный конфигмап

можем провалиться в контейнер и проверить конфиг файл /etc/alloy

alloy/4.alloy
alloy/5.alloy - рабочие конфиг файлы


---
добавил в конфиг 6.alloy: prometheus.scrape "kubelet" для сбора ресурсов 

провалидировал и обновил конфигмап 

для "Kubernetes / Compute Resources / Cluster" переписал дашборд СPU Utilisation без recodrding rules


